define(["utils/utils","mvc/ui/ui-misc"],function(a,b){var c=Backbone.View.extend({initialize:function(){this.setElement("<div/>"),this.render()},render:function(){var c=this,d=3;a.get({url:Galaxy.root+"api/histories/published/",data:{detailed:"detailed"},success:function(a){var b=[],e=null;c.$el.empty().append(c._templateHeader()),_.each(a,function(a){_.each(a.tags,function(a){_.contains(b,a)||b.push(a)})}),e=c.$el.find(".published-histories"),e.append(c._templateTagsTableActionButtons()),e.append(c._templateHistoryTagsTable(c,b)),c.register_tag_click(c,b,a),c.filter_items(c,c.$el.find(".search-tags-input"),c.$el.find(".search-tags-tbody tr"),d)},error:function(){var a="Error occurred while loading the resource.",d={message:a,status:"error",persistent:!0,cls:"errormessage"},e=new b.Message(d);c.$el.empty().append(e.$el)}})},register_tag_click:function(a,b,c){_.each(b,function(b){var d=a.$el.find(".published-histories");d.find(".history-tag-"+b).click(function(e){e.preventDefault();var f=a._templatePublishedHistoryTable(a,c,b),g=d.find(".tr-"+b),h=d.find(".tr-"+b+" td");h.empty().append(f),"none"===g.css("display")?(g.show(),d.find(".history-tag-"+b).removeClass("fa-plus-square-o").addClass("fa-minus-square-o ")):(g.hide(),d.find(".history-tag-"+b).addClass("fa-plus-square-o").removeClass("fa-minus-square-o "))})})},filter_items:function(a,b,c,d){b.on("keyup",function(){var a=$(this).val();if(a.length>=d){var b=new RegExp(a,"i");c.hide(),c.filter(function(){return b.test($(this).text())}).show()}else c.show()})},_templateHeader:function(){return'<div class="page-container"><div class="published-histories"><h2>Published Histories</h2></div></div>'},_templateHistoryTagsTable:function(a,b){var c="",d="";return c+='<table class="table colored"><thead><tr class="header"><th>Tag names</th></tr></thead>',_.each(b,function(a){d=d+'<tr><td> <a class="fa fa-plus-square-o history-tag-'+a+' tags-link"><span>'+a.toLowerCase()+'</span></a></td></tr><tr class="tr-'+a+' published-history-tr"><td></td></tr>'}),c+'<tbody class="search-tags-tbody">'+d+"</tbody></table>"},_templateTagsTableActionButtons:function(){return'<ul class="manage-table-actions"><li><input class="search-tags-input form-control" type="text" autocomplete="off" placeholder="search for tags..."></li></ul>'},_templatePublishedHistoryTable:function(a,b,c){var d="",e="";return d+='<table class="table colored"><thead><tr class="header"><th>Name</th><th>Annotation</th></tr></thead>',_.each(b,function(a){_.contains(a.tags,c)&&(e=e+"<tr><td><a href="+Galaxy.root+a.username_and_slug+">"+_.escape(a.name)+"</a></td><td>"+_.escape(a.annotation)+"</td></tr>")}),d+'<tbody class="history_item-search">'+e+"</tbody></table>"}});return{View:c}});
//# sourceMappingURL=../../../maps/mvc/history/published-history-view.js.map